<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>üç≤ A Bowl from Lifesoup</title>
<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:ital,wght@0,300;0,400;0,500;0,600;1,300;1,400;1,500&display=swap" rel="stylesheet"/>
<style>
:root{
  --broth:#d4531a; --broth-deep:#9e3610; --broth-lite:#f08050;
  --steam:#fff7f0; --cream:#fefaf5;
  --bowl-rim:#e8c89a; --bowl-body:#f5e0c0;
  --gold:#c07820; --ink:#2a1505; --muted:#8a6040; --border:#ead8b8;
}
*{box-sizing:border-box;margin:0;padding:0;}
html{font-size:16px;}
body{font-family:'IBM Plex Mono',monospace;background:var(--cream);color:var(--ink);min-height:100vh;overflow-x:hidden;-webkit-text-size-adjust:100%;}
body::after{content:'';position:fixed;inset:0;background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.75' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.03'/%3E%3C/svg%3E");pointer-events:none;z-index:9999;}
.page{display:none;}.page.active{display:block;}

/* ‚îÄ‚îÄ CREATOR ‚îÄ‚îÄ */
#creator{max-width:600px;margin:0 auto;padding:36px 16px 60px;}
.c-header{text-align:center;margin-bottom:44px;}
.logo-bowl{display:inline-block;font-size:2.8rem;animation:wobble 4s ease-in-out infinite;margin-bottom:6px;filter:drop-shadow(0 4px 12px rgba(212,83,26,.3));}
@keyframes wobble{0%,100%{transform:rotate(-4deg) scale(1);}50%{transform:rotate(4deg) scale(1.06);}}
.c-brand{font-family:'IBM Plex Mono',monospace;font-size:clamp(1.7rem,6vw,2.8rem);font-weight:600;color:var(--ink);line-height:1.15;letter-spacing:-.03em;}
.c-brand em{font-style:italic;color:var(--broth);}
.c-tagline{margin-top:10px;font-size:.8rem;color:var(--muted);font-weight:300;max-width:360px;margin-left:auto;margin-right:auto;line-height:1.7;}
.steam-wrap{display:flex;justify-content:center;gap:14px;margin-bottom:8px;height:36px;overflow:hidden;}
.steam-wisp{width:3px;border-radius:10px;background:linear-gradient(to top,rgba(212,83,26,.3),transparent);animation:steamRise 2.4s ease-in-out infinite;}
.steam-wisp:nth-child(1){height:26px;animation-delay:0s;}.steam-wisp:nth-child(2){height:34px;animation-delay:.4s;}.steam-wisp:nth-child(3){height:22px;animation-delay:.8s;}.steam-wisp:nth-child(4){height:30px;animation-delay:.2s;}.steam-wisp:nth-child(5){height:18px;animation-delay:.6s;}
@keyframes steamRise{0%{transform:translateY(0) scaleX(1);opacity:0;}20%{opacity:.7;}100%{transform:translateY(-34px) scaleX(1.8);opacity:0;}}

.step{background:white;border:1.5px solid var(--border);border-radius:18px;padding:30px 22px;margin-bottom:14px;position:relative;box-shadow:0 2px 16px rgba(212,83,26,.05);}
.step-badge{position:absolute;top:-13px;left:18px;background:var(--broth);color:white;font-family:'IBM Plex Mono',monospace;font-size:.7rem;font-weight:600;padding:4px 12px;border-radius:100px;letter-spacing:.06em;white-space:nowrap;}
.step-title{font-family:'IBM Plex Mono',monospace;font-size:1rem;font-weight:500;font-style:italic;color:var(--ink);margin-bottom:20px;margin-top:6px;}
.field{margin-bottom:16px;}.field:last-child{margin-bottom:0;}
.lbl{display:block;font-size:.65rem;font-weight:500;letter-spacing:.14em;text-transform:uppercase;color:var(--broth);margin-bottom:6px;}
input[type=text],textarea,select{width:100%;border:1.5px solid var(--border);border-radius:10px;padding:12px 14px;font-family:'IBM Plex Mono',monospace;font-size:.85rem;color:var(--ink);background:var(--steam);outline:none;transition:border .2s,box-shadow .2s;-webkit-appearance:none;line-height:1.5;}
input[type=text]:focus,textarea:focus,select:focus{border-color:var(--broth);box-shadow:0 0 0 3px rgba(212,83,26,.1);}
textarea{resize:none;height:86px;line-height:1.65;}
.two-col{display:flex;gap:12px;flex-wrap:wrap;}.two-col .field{flex:1;min-width:120px;}
.tb-row{display:flex;align-items:center;gap:8px;flex-wrap:wrap;}.tb-row select{flex:1;min-width:160px;cursor:pointer;}
.tb-name{font-family:'IBM Plex Mono',monospace;font-size:1rem;font-style:italic;font-weight:600;color:var(--broth);white-space:nowrap;}
.items-wrap{display:flex;flex-direction:column;gap:8px;margin-bottom:10px;}
.item-row{display:flex;align-items:center;gap:8px;}
.item-noodle{width:26px;height:26px;border-radius:50%;background:linear-gradient(135deg,var(--bowl-rim),var(--bowl-body));border:1.5px solid var(--border);display:flex;align-items:center;justify-content:center;font-family:'IBM Plex Mono',monospace;font-size:.75rem;color:var(--broth);font-weight:600;flex-shrink:0;}
.item-field{flex:1;border:1.5px solid var(--border);border-radius:9px;padding:10px 12px;font-size:.82rem;font-family:'IBM Plex Mono',monospace;color:var(--ink);background:var(--steam);outline:none;transition:border .2s,box-shadow .2s;min-width:0;}
.item-field:focus{border-color:var(--broth);box-shadow:0 0 0 3px rgba(212,83,26,.08);}
.item-del{background:none;border:none;cursor:pointer;font-size:.9rem;color:#d4b89a;padding:4px;transition:color .15s,transform .15s;line-height:1;flex-shrink:0;}
.item-del:hover{color:var(--broth);transform:scale(1.2);}
.add-row{display:flex;align-items:center;gap:8px;background:none;border:1.5px dashed var(--border);border-radius:9px;padding:10px 14px;font-family:'IBM Plex Mono',monospace;font-size:.8rem;color:var(--broth);cursor:pointer;transition:background .15s,border-color .15s;font-weight:500;width:100%;}
.add-row:hover{background:var(--steam);border-color:var(--broth);}
.gen-btn{width:100%;background:linear-gradient(135deg,var(--broth),var(--broth-deep));color:white;border:none;border-radius:12px;padding:16px 14px;font-family:'IBM Plex Mono',monospace;font-size:.82rem;font-weight:600;cursor:pointer;transition:transform .15s,box-shadow .15s;display:flex;align-items:center;justify-content:center;gap:8px;margin-top:18px;box-shadow:0 4px 22px rgba(212,83,26,.3);}
.gen-btn:hover{transform:translateY(-2px);box-shadow:0 8px 30px rgba(212,83,26,.45);}
.gen-btn:active{transform:translateY(0);}

#link-box{display:none;margin-top:14px;background:white;border:1.5px solid var(--border);border-radius:16px;padding:20px;}
.link-label{font-size:.65rem;font-weight:600;letter-spacing:.14em;text-transform:uppercase;color:var(--gold);margin-bottom:10px;}
.link-url{font-family:'IBM Plex Mono',monospace;font-size:.78rem;color:var(--ink);word-break:break-all;background:var(--steam);border:1.5px solid var(--border);border-radius:9px;padding:11px 13px;margin-bottom:12px;line-height:1.5;}
.link-actions{display:flex;gap:8px;flex-wrap:wrap;}
.la-btn{flex:1;min-width:90px;padding:11px 10px;border-radius:9px;font-family:'IBM Plex Mono',monospace;font-size:.75rem;font-weight:500;cursor:pointer;border:1.5px solid;transition:all .15s;display:flex;align-items:center;justify-content:center;gap:6px;white-space:nowrap;}
.la-copy{background:var(--steam);border-color:var(--border);color:var(--broth);}
.la-copy:hover{border-color:var(--broth);background:#feeee5;}
.la-preview{background:white;border-color:#ddd;color:#888;}
.la-preview:hover{border-color:var(--broth);color:var(--broth);}
.la-sms{background:linear-gradient(135deg,var(--broth),var(--broth-deep));border-color:transparent;color:white;}
.la-sms:hover{transform:translateY(-1px);box-shadow:0 4px 14px rgba(212,83,26,.35);}

#preview-panel{display:none;margin-top:14px;border:1.5px solid var(--border);border-radius:16px;overflow:hidden;}
.preview-header{background:var(--broth);color:white;padding:10px 16px;display:flex;align-items:center;justify-content:space-between;font-family:'IBM Plex Mono',monospace;font-size:.72rem;font-weight:600;letter-spacing:.06em;text-transform:uppercase;}
.preview-close{background:rgba(255,255,255,.2);border:none;color:white;width:24px;height:24px;border-radius:50%;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:.9rem;transition:background .15s;flex-shrink:0;}
.preview-close:hover{background:rgba(255,255,255,.35);}
.preview-body{background:var(--cream);padding:0 0 24px;display:flex;flex-direction:column;align-items:center;width:100%;max-height:600px;overflow-y:auto;}
.preview-body .v-hero{padding:28px 16px 0;max-width:100%;}
.preview-body .v-main-title{font-size:clamp(1.1rem,3.5vw,1.5rem);margin-bottom:18px;}
.preview-body .bowl-container{width:190px;height:146px;margin:6px auto 26px;}
.preview-body .bowl-svg{width:190px;height:146px;}
.preview-body .v-soup-card{margin-bottom:12px;max-width:calc(100% - 24px);}
.preview-body .v-letter-card{margin-bottom:12px;max-width:calc(100% - 24px);}

.address-footer{text-align:center;padding:20px 16px 32px;font-family:'IBM Plex Mono',monospace;font-size:.72rem;color:var(--muted);letter-spacing:.06em;line-height:1.7;border-top:1px dashed var(--border);margin-top:30px;}
.address-footer strong{color:var(--broth);font-weight:600;}

/* ‚îÄ‚îÄ VIEWER PAGE ‚îÄ‚îÄ */
#viewer{min-height:100vh;display:flex;flex-direction:column;align-items:center;padding:0 12px 80px;position:relative;overflow:hidden;background:var(--cream);}
.v-bg{position:fixed;inset:0;background:radial-gradient(ellipse 70% 50% at 15% 15%,rgba(212,83,26,.07) 0%,transparent 60%),radial-gradient(ellipse 60% 70% at 85% 85%,rgba(200,160,80,.08) 0%,transparent 60%),var(--cream);z-index:-1;}

/* Viewer hero */
.v-hero{width:100%;max-width:540px;text-align:center;padding:50px 16px 0;}
.v-sent-by{font-family:'IBM Plex Mono',monospace;font-size:.82rem;font-style:italic;color:var(--muted);letter-spacing:.04em;margin-bottom:10px;}
.v-site-name{font-family:'IBM Plex Mono',monospace;font-size:.72rem;font-weight:500;color:var(--muted);text-transform:uppercase;letter-spacing:.16em;margin-bottom:6px;}
.v-main-title{font-family:'IBM Plex Mono',monospace;font-size:clamp(1.3rem,4.5vw,2.2rem);font-weight:600;font-style:italic;color:var(--broth);line-height:1.25;max-width:500px;margin:0 auto 16px;letter-spacing:-.02em;}

/* Bowl */
.bowl-container{position:relative;width:260px;height:200px;margin:8px auto 38px;animation:bowlDrop .7s cubic-bezier(.34,1.56,.64,1) .1s both;}
@keyframes bowlDrop{from{transform:translateY(-40px) scale(.8);opacity:0;}to{transform:translateY(0) scale(1);opacity:1;}}
.bowl-svg{width:260px;height:200px;}
.bowl-steam{position:absolute;top:6px;left:50%;transform:translateX(-50%);display:flex;gap:10px;pointer-events:none;}
.bs{width:3px;border-radius:8px;background:linear-gradient(to top,rgba(200,120,80,.5),transparent);animation:bsteam 2s ease-in-out infinite;}
.bs:nth-child(1){height:28px;animation-delay:0s;}.bs:nth-child(2){height:38px;animation-delay:.5s;}.bs:nth-child(3){height:24px;animation-delay:1s;}
@keyframes bsteam{0%{transform:translateY(0) scaleX(1);opacity:0;}20%{opacity:.9;}100%{transform:translateY(-46px) scaleX(2.2);opacity:0;}}
.ingredient{position:absolute;font-size:1rem;animation:ingredientFloat linear infinite;pointer-events:none;}
@keyframes ingredientFloat{0%{transform:translateY(0) translateX(0) rotate(0deg);opacity:0;}10%{opacity:1;}90%{opacity:.5;}100%{transform:translateY(-110px) translateX(var(--drift)) rotate(var(--spin));opacity:0;}}

/* ‚îÄ‚îÄ SOUP CARD ‚Äî NO ANIMATION, always visible ‚îÄ‚îÄ */
.v-soup-card{
  width:100%;max-width:540px;
  background:white;
  border-radius:20px;
  margin-bottom:16px;
  box-shadow:0 8px 40px rgba(150,60,10,.12);
  overflow:hidden;
}
.v-soup-header{
  background:linear-gradient(135deg,var(--broth),var(--broth-deep));
  padding:20px 24px;
  display:flex;align-items:center;gap:14px;
}
.v-soup-icon{font-size:1.8rem;}
.v-soup-label{font-family:'IBM Plex Mono',monospace;font-size:.78rem;font-weight:300;font-style:italic;color:rgba(255,255,255,.85);line-height:1.4;}
.v-soup-name{font-family:'IBM Plex Mono',monospace;font-size:1.2rem;font-weight:600;color:white;line-height:1.2;}
.v-soup-items{padding:8px 24px 20px;}
.v-soup-item{
  display:flex;
  align-items:flex-start;
  gap:14px;
  padding:14px 0;
  border-bottom:1px dashed var(--border);
}
.v-soup-item:last-child{border-bottom:none;}
.v-soup-num{
  width:28px;height:28px;border-radius:50%;
  background:linear-gradient(135deg,var(--broth-lite),var(--broth));
  color:white;font-family:'IBM Plex Mono',monospace;font-size:.8rem;font-weight:600;
  display:flex;align-items:center;justify-content:center;
  flex-shrink:0;margin-top:2px;
}
.v-soup-text{font-family:'IBM Plex Mono',monospace;font-size:.9rem;line-height:1.6;color:var(--ink);padding-top:3px;}

/* ‚îÄ‚îÄ LETTER CARD ‚Äî NO ANIMATION, always visible ‚îÄ‚îÄ */
.v-letter-card{
  width:100%;max-width:540px;
  background:white;
  border-radius:20px;
  padding:44px 32px 44px;
  margin-bottom:16px;
  position:relative;
  box-shadow:0 8px 40px rgba(150,60,10,.1);
}
.v-letter-card::before{content:'';position:absolute;top:0;left:0;right:0;height:4px;background:linear-gradient(90deg,var(--broth),var(--gold),var(--broth-lite),var(--broth));}
.v-wax{
  position:absolute;top:-20px;right:28px;
  width:46px;height:46px;
  background:linear-gradient(135deg,var(--broth),var(--broth-deep));
  border-radius:50%;display:flex;align-items:center;justify-content:center;
  font-size:1.3rem;box-shadow:0 4px 14px rgba(212,83,26,.4);
}
.v-dear{font-family:'IBM Plex Mono',monospace;font-size:1rem;font-style:italic;color:var(--gold);margin-bottom:22px;}
.v-letter-item{display:flex;align-items:flex-start;gap:12px;margin-bottom:14px;}
.v-dot{width:8px;height:8px;border-radius:50%;background:var(--broth-lite);flex-shrink:0;margin-top:7px;}
.v-item-text{font-family:'IBM Plex Mono',monospace;font-size:.9rem;line-height:1.65;color:var(--ink);font-style:italic;}
.v-note{border-top:1.5px dashed var(--border);padding-top:20px;margin-top:8px;font-family:'IBM Plex Mono',monospace;font-size:.88rem;font-style:italic;line-height:1.7;color:var(--ink);white-space:pre-wrap;}
.v-sig{text-align:right;margin-top:22px;font-family:'IBM Plex Mono',monospace;font-size:1rem;font-style:italic;font-weight:600;color:var(--gold);}

/* CTA */
.v-cta{width:100%;max-width:540px;text-align:center;margin-top:8px;padding-bottom:8px;}
.v-cta p{font-size:.75rem;color:var(--muted);margin-bottom:10px;}
.make-own{display:inline-flex;align-items:center;gap:8px;background:white;border:1.5px solid var(--border);border-radius:100px;padding:10px 22px;font-family:'IBM Plex Mono',monospace;font-size:.8rem;font-weight:500;color:var(--broth);cursor:pointer;transition:all .15s;text-decoration:none;}
.make-own:hover{background:var(--steam);border-color:var(--broth);}

/* Floaters */
.floater{position:fixed;pointer-events:none;animation:floatUp linear infinite;z-index:2;opacity:0;}
@keyframes floatUp{0%{transform:translateY(105vh) scale(.5);opacity:0;}8%{opacity:.65;}92%{opacity:.35;}100%{transform:translateY(-15vh) scale(1.1) rotate(20deg);opacity:0;}}

/* Toast */
.toast{position:fixed;bottom:24px;left:50%;transform:translateX(-50%) translateY(56px);background:var(--ink);color:white;padding:10px 20px;border-radius:100px;font-family:'IBM Plex Mono',monospace;font-size:.78rem;font-weight:500;pointer-events:none;transition:transform .3s cubic-bezier(.34,1.56,.64,1);z-index:10000;white-space:nowrap;}
.toast.show{transform:translateX(-50%) translateY(0);}

/* Mobile */
@media(max-width:420px){
  #creator{padding:28px 12px 60px;}
  .step{padding:26px 16px;}
  .two-col{flex-direction:column;gap:0;}.two-col .field{min-width:100%;}
  .tb-row{flex-direction:column;align-items:flex-start;}.tb-row select{min-width:100%;}
  .link-actions{flex-direction:column;}.la-btn{min-width:100%;}
  .bowl-container{width:200px;height:154px;}.bowl-svg{width:200px;height:154px;}
  .v-letter-card{padding:36px 18px 36px;}
  .v-soup-header{padding:16px 18px;}.v-soup-items{padding:6px 18px 16px;}
}
</style>
</head>
<body>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê CREATOR ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="creator" class="page active">
  <div class="c-header">
    <div class="steam-wrap">
      <div class="steam-wisp"></div><div class="steam-wisp"></div>
      <div class="steam-wisp"></div><div class="steam-wisp"></div>
      <div class="steam-wisp"></div>
    </div>
    <div class="logo-bowl">üç≤</div>
    <h1 class="c-brand">A Bowl from <em>Lifesoup</em></h1>
    <p class="c-tagline">Send a bowl filled with reasons, add a heartfelt note, and share a link they'll never forget.</p>
  </div>

  <div class="step">
    <div class="step-badge">üßÖ Step 1</div>
    <h2 class="step-title">Who's getting this bowl?</h2>
    <div class="two-col">
      <div class="field"><label class="lbl">Your name</label><input type="text" id="sender" placeholder="e.g. Alex" maxlength="40"/></div>
      <div class="field"><label class="lbl">Their name</label><input type="text" id="recipient" placeholder="e.g. Jordan" maxlength="40"/></div>
    </div>
  </div>

  <div class="step">
    <div class="step-badge">ü•ï Step 2 ‚Äî The ingredients</div>
    <h2 class="step-title">What's in your bowl?</h2>
    <div class="field">
      <label class="lbl">Bowl title</label>
      <div class="tb-row">
        <select id="prefix">
          <option>reasons I love</option>
          <option>reasons I'm obsessed with</option>
          <option>things I adore about</option>
          <option>reasons you're my person,</option>
          <option>reasons I'd go down on one knee for</option>
          <option>ways you make my heart skip,</option>
          <option>times you made me smile,</option>
          <option>reasons you're simply the best,</option>
          <option>reasons I'd choose you again,</option>
        </select>
        <span class="tb-name" id="name-preview">you</span>
      </div>
    </div>
    <div class="field">
      <label class="lbl">Your reasons ü´∂</label>
      <div class="items-wrap" id="items-list"></div>
      <button class="add-row" onclick="addItem()">Ôºã Add another ingredient</button>
    </div>
  </div>

  <div class="step">
    <div class="step-badge">üåø Step 3 ‚Äî The broth (optional)</div>
    <h2 class="step-title">Anything extra from the heart?</h2>
    <div class="field"><textarea id="note" placeholder="Pour in something warm and personal‚Ä¶"></textarea></div>
  </div>

  <button class="gen-btn" onclick="generateLink()">üç≤ Serve my bowl to my crush</button>

  <div id="link-box">
    <div class="link-label">‚ú¶ Your bowl is ready to serve</div>
    <div class="link-url" id="link-url-text"></div>
    <div class="link-actions">
      <button class="la-btn la-copy" onclick="copyLink()">üìã Copy link</button>
      <button class="la-btn la-preview" onclick="togglePreview()">üëÅ Preview it</button>
      <button class="la-btn la-sms" onclick="sendViaSMS()">üí¨ Send via text</button>
    </div>
  </div>

  <div id="preview-panel">
    <div class="preview-header">
      <span>üëÅ What your crush sees</span>
      <button class="preview-close" onclick="closePreview()">‚úï</button>
    </div>
    <div class="preview-body" id="preview-body-content"></div>
  </div>

  <div class="address-footer">
    <strong>A Bowl from Lifesoup</strong><br>
    3492 Satellite Blvd, Duluth, GA
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê VIEWER ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="viewer" class="page">
  <div class="v-bg"></div>
  <div id="viewer-content" style="width:100%;display:flex;flex-direction:column;align-items:center;"></div>
</div>

<div class="toast" id="toast"></div>

<script>
// ‚îÄ‚îÄ ITEMS ‚îÄ‚îÄ
let items=['',''];
function renderItems(){
  const list=document.getElementById('items-list');
  list.innerHTML='';
  items.forEach((v,i)=>{
    const row=document.createElement('div');
    row.className='item-row';
    row.innerHTML=`<div class="item-noodle">${i+1}</div><input class="item-field" type="text" placeholder="e.g. the way you light up every room üåü" value="${esc(v)}" maxlength="140" oninput="items[${i}]=this.value"/><button class="item-del" onclick="removeItem(${i})">‚úï</button>`;
    list.appendChild(row);
  });
}
function addItem(){
  if(items.length>=20){showToast('Bowl is full at 20! üç≤');return;}
  items.push('');renderItems();
  setTimeout(()=>{const inp=document.querySelectorAll('.item-field');inp[inp.length-1].focus();},50);
}
function removeItem(i){
  if(items.length<=1){showToast('Need at least one ingredient! ü•ï');return;}
  items.splice(i,1);renderItems();
}
document.getElementById('recipient').addEventListener('input',function(){
  document.getElementById('name-preview').textContent=this.value.trim()||'you';
});
renderItems();

// ‚îÄ‚îÄ GENERATE ‚îÄ‚îÄ
let generatedLink='';
let lastData=null;
function generateLink(){
  const sender=document.getElementById('sender').value.trim();
  const recipient=document.getElementById('recipient').value.trim();
  const prefix=document.getElementById('prefix').value;
  const note=document.getElementById('note').value.trim();
  // Read directly from the DOM inputs ‚Äî never trust items[] array alone
  const inputs=document.querySelectorAll('.item-field');
  const filled=Array.from(inputs).map(el=>el.value.trim()).filter(v=>v.length>0);
  if(!recipient){showToast('Add their name first! üßÖ');return;}
  if(!filled.length){showToast('Add at least one ingredient! ü•ï');return;}
  lastData={s:sender,r:recipient,p:prefix,n:note,i:filled};
  const encoded=btoa(unescape(encodeURIComponent(JSON.stringify(lastData))));
  const base=window.location.href.split('?')[0].split('#')[0];
  generatedLink=base+'?bowl='+encoded;
  document.getElementById('link-url-text').textContent=generatedLink;
  const box=document.getElementById('link-box');
  box.style.display='block';
  document.getElementById('preview-panel').style.display='none';
  box.scrollIntoView({behavior:'smooth',block:'nearest'});
  confetti();
}
function copyLink(){
  navigator.clipboard.writeText(generatedLink)
    .then(()=>showToast('üç≤ Link copied! Go serve it!'))
    .catch(()=>{const ta=document.createElement('textarea');ta.value=generatedLink;document.body.appendChild(ta);ta.select();document.execCommand('copy');document.body.removeChild(ta);showToast('üç≤ Copied!');});
}
function sendViaSMS(){
  window.location.href='sms:?body='+encodeURIComponent('I made you something warm üç≤ Open this: '+generatedLink);
}
function togglePreview(){
  const panel=document.getElementById('preview-panel');
  if(panel.style.display==='block'){closePreview();return;}
  const body=document.getElementById('preview-body-content');
  body.innerHTML='';
  buildViewerDOM(lastData,body,true);
  panel.style.display='block';
  panel.scrollIntoView({behavior:'smooth',block:'nearest'});
}
function closePreview(){
  document.getElementById('preview-panel').style.display='none';
}

// ‚îÄ‚îÄ DOLSOT SVG ‚îÄ‚îÄ
function dolsotSVG(){
  return `<svg class="bowl-svg" viewBox="0 0 300 220" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <linearGradient id="stoneBody" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" stop-color="#5a4a3a"/><stop offset="35%" stop-color="#3a2e22"/>
      <stop offset="70%" stop-color="#2a2018"/><stop offset="100%" stop-color="#1e1610"/>
    </linearGradient>
    <linearGradient id="rimTop" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" stop-color="#6a5540"/><stop offset="40%" stop-color="#4a3828"/><stop offset="100%" stop-color="#2e2218"/>
    </linearGradient>
    <linearGradient id="rimFront" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" stop-color="#4a3828"/><stop offset="100%" stop-color="#1e1610"/>
    </linearGradient>
    <radialGradient id="broth" cx="42%" cy="38%" r="62%">
      <stop offset="0%" stop-color="#e85820"/><stop offset="45%" stop-color="#c04010"/><stop offset="100%" stop-color="#802808"/>
    </radialGradient>
    <linearGradient id="handleGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" stop-color="#5a4838"/><stop offset="100%" stop-color="#2a1e14"/>
    </linearGradient>
    <filter id="softglow" x="-20%" y="-20%" width="140%" height="140%">
      <feGaussianBlur stdDeviation="2.5" result="blur"/>
      <feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge>
    </filter>
  </defs>
  <ellipse cx="150" cy="212" rx="95" ry="9" fill="rgba(0,0,0,.28)"/>
  <path d="M28,96 L54,96 L54,112 L28,112 Z" fill="url(#handleGrad)"/>
  <path d="M28,96 L54,96 L54,100 L28,100 Z" fill="rgba(255,255,255,.08)"/>
  <path d="M28,96 L54,96 L54,112 L28,112 Z" fill="none" stroke="#1a1208" stroke-width="1.5"/>
  <ellipse cx="41" cy="104" rx="7" ry="4.5" fill="#1a1208"/>
  <ellipse cx="41" cy="103" rx="5.5" ry="3" fill="#120e08"/>
  <path d="M246,96 L272,96 L272,112 L246,112 Z" fill="url(#handleGrad)"/>
  <path d="M246,96 L272,96 L272,100 L246,100 Z" fill="rgba(255,255,255,.08)"/>
  <path d="M246,96 L272,96 L272,112 L246,112 Z" fill="none" stroke="#1a1208" stroke-width="1.5"/>
  <ellipse cx="259" cy="104" rx="7" ry="4.5" fill="#1a1208"/>
  <ellipse cx="259" cy="103" rx="5.5" ry="3" fill="#120e08"/>
  <path d="M54,104 Q50,190 150,196 Q250,190 246,104 Z" fill="url(#stoneBody)"/>
  <path d="M70,118 Q100,115 130,117 Q160,119 190,115 Q210,113 225,116" fill="none" stroke="rgba(255,255,255,.045)" stroke-width="1.2"/>
  <path d="M65,132 Q95,129 128,131 Q162,133 198,128 Q218,126 230,129" fill="none" stroke="rgba(0,0,0,.18)" stroke-width=".9"/>
  <path d="M62,146 Q94,143 128,145 Q164,147 202,141 Q222,139 234,142" fill="none" stroke="rgba(255,255,255,.03)" stroke-width="1"/>
  <path d="M60,161 Q92,157 128,159 Q166,161 206,155 Q226,153 238,156" fill="none" stroke="rgba(0,0,0,.14)" stroke-width=".9"/>
  <path d="M54,104 Q54,120 150,124 Q246,120 246,104" fill="url(#rimFront)"/>
  <ellipse cx="150" cy="104" rx="96" ry="20" fill="url(#rimTop)"/>
  <ellipse cx="135" cy="99" rx="52" ry="8" fill="rgba(255,255,255,.09)"/>
  <ellipse cx="150" cy="104" rx="96" ry="20" fill="none" stroke="#140e08" stroke-width="2"/>
  <ellipse cx="150" cy="104" rx="84" ry="16" fill="rgba(0,0,0,.32)"/>
  <ellipse cx="150" cy="104" rx="84" ry="15.5" fill="url(#broth)"/>
  <ellipse cx="128" cy="99" rx="34" ry="7" fill="rgba(255,200,120,.13)"/>
  <ellipse cx="120" cy="97" rx="18" ry="4" fill="rgba(255,240,200,.1)"/>
  <ellipse cx="88" cy="102" rx="10" ry="5" fill="rgba(248,242,218,.6)" opacity=".8"/>
  <rect x="155" y="96" width="12" height="9" rx="2" fill="rgba(248,240,210,.75)" opacity=".85"/>
  <rect x="168" y="98" width="10" height="8" rx="2" fill="rgba(245,237,205,.65)" opacity=".8"/>
  <path d="M100,104 Q108,99 116,104 Q112,108 104,106Z" fill="#c83018" opacity=".8"/>
  <path d="M125,107 Q136,100 147,107 Q138,113 127,111Z" fill="rgba(200,195,185,.55)"/>
  <path d="M170,105 Q178,99 182,105 Q180,110 172,109Z" fill="#8a6a40" opacity=".85"/>
  <circle cx="150" cy="100" r="7" fill="rgba(240,180,30,.6)" filter="url(#softglow)"/>
  <circle cx="150" cy="100" r="4.5" fill="rgba(250,200,40,.8)"/>
  <ellipse cx="108" cy="95" rx="3" ry="5" fill="#4a8830" opacity=".9" transform="rotate(30,108,95)"/>
  <ellipse cx="192" cy="97" rx="2.5" ry="4.5" fill="#5a9838" opacity=".85" transform="rotate(-20,192,97)"/>
  <ellipse cx="140" cy="94" rx="1.8" ry="1.2" fill="rgba(200,170,100,.9)" transform="rotate(30,140,94)"/>
  <ellipse cx="162" cy="93" rx="1.8" ry="1.2" fill="rgba(200,170,100,.85)" transform="rotate(-15,162,93)"/>
  <ellipse cx="150" cy="196" rx="80" ry="7" fill="rgba(220,80,20,.08)" filter="url(#softglow)"/>
</svg>`;
}

// ‚îÄ‚îÄ BUILD VIEWER DOM ‚îÄ‚îÄ
function buildViewerDOM(data, container, isPreview){
  const sender   = data.s || 'someone special';
  const recipient= data.r || 'you';
  const prefix   = data.p || 'reasons I love';
  const note     = data.n || '';
  const itemList = data.i || [];

  if(!isPreview){
    const fe=['üç≤','üíó','‚ú®','ü•ï','üåø','üíõ','ü´∂','üå∏','üçú','üíù'];
    for(let i=0;i<16;i++){
      const f=document.createElement('div');f.className='floater';
      f.textContent=fe[Math.floor(Math.random()*fe.length)];
      f.style.left=Math.random()*100+'vw';
      f.style.animationDuration=(9+Math.random()*14)+'s';
      f.style.animationDelay=(Math.random()*8)+'s';
      f.style.fontSize=(.85+Math.random()*.9)+'rem';
      document.body.appendChild(f);
    }
  }

  // Hero
  const hero=document.createElement('div');
  hero.className='v-hero';
  hero.innerHTML=`
    <div class="v-sent-by">from ${hesc(sender)}, with love üç≤</div>
    <div class="v-site-name">A Bowl from Lifesoup</div>
    <div class="v-main-title">${hesc(prefix)} ${hesc(recipient)}</div>
  `;
  container.appendChild(hero);

  // Bowl
  const bowlWrap=document.createElement('div');
  bowlWrap.className='bowl-container';
  bowlWrap.innerHTML=`<div class="bowl-steam"><div class="bs"></div><div class="bs"></div><div class="bs"></div></div>${dolsotSVG()}`;
  const ie=['‚ú®','üíó','üåø','üíõ','ü´∂','üå∏'];
  for(let i=0;i<6;i++){
    const ing=document.createElement('div');ing.className='ingredient';
    ing.textContent=ie[i%ie.length];
    ing.style.cssText=`left:${70+Math.random()*100}px;top:${55+Math.random()*35}px;--drift:${(Math.random()-.5)*55}px;--spin:${(Math.random()-.5)*110}deg;animation-duration:${2+Math.random()*2}s;animation-delay:${.5+i*.25}s;`;
    bowlWrap.appendChild(ing);
  }
  container.appendChild(bowlWrap);

  // ‚îÄ‚îÄ SOUP CARD ‚îÄ‚îÄ
  const soupCard=document.createElement('div');
  soupCard.className='v-soup-card';

  const header=document.createElement('div');
  header.className='v-soup-header';
  header.innerHTML=`<div class="v-soup-icon">üç≤</div><div><div class="v-soup-label">${hesc(prefix)}</div><div class="v-soup-name">${hesc(recipient)}</div></div>`;
  soupCard.appendChild(header);

  const itemsDiv=document.createElement('div');
  itemsDiv.className='v-soup-items';
  itemList.forEach((item,i)=>{
    const row=document.createElement('div');
    row.className='v-soup-item';
    row.innerHTML=`<div class="v-soup-num">${i+1}</div><div class="v-soup-text">${hesc(item)}</div>`;
    itemsDiv.appendChild(row);
  });
  soupCard.appendChild(itemsDiv);
  container.appendChild(soupCard);

  // ‚îÄ‚îÄ LETTER CARD ‚îÄ‚îÄ
  const lCard=document.createElement('div');
  lCard.className='v-letter-card';

  const wax=document.createElement('div');wax.className='v-wax';wax.textContent='üç≤';
  lCard.appendChild(wax);

  const dear=document.createElement('div');dear.className='v-dear';dear.textContent=`${prefix} ${recipient},`;
  lCard.appendChild(dear);

  const lItems=document.createElement('div');
  itemList.forEach(item=>{
    const row=document.createElement('div');row.className='v-letter-item';
    row.innerHTML=`<div class="v-dot"></div><div class="v-item-text">${hesc(item)}</div>`;
    lItems.appendChild(row);
  });
  lCard.appendChild(lItems);

  if(note){
    const n=document.createElement('div');n.className='v-note';n.textContent=note;
    lCard.appendChild(n);
  }

  const sig=document.createElement('div');sig.className='v-sig';sig.textContent=`Yours always, ${sender} üç≤`;
  lCard.appendChild(sig);
  container.appendChild(lCard);

  // CTA + address
  const cta=document.createElement('div');cta.className='v-cta';
  cta.innerHTML=`<p>Want to serve your own bowl?</p><a class="make-own" href="${window.location.pathname}">üç≤ Make my own</a>`;
  container.appendChild(cta);

  const addr=document.createElement('div');
  addr.style.cssText='text-align:center;padding:16px;font-family:IBM Plex Mono,monospace;font-size:.72rem;color:var(--muted);letter-spacing:.06em;line-height:1.8;border-top:1px dashed var(--border);margin-top:16px;width:100%;max-width:540px;';
  addr.innerHTML=`<strong style="color:var(--broth)">A Bowl from Lifesoup</strong><br>3492 Satellite Blvd, Duluth, GA`;
  container.appendChild(addr);

  if(!isPreview){setTimeout(()=>confetti(),600);setTimeout(()=>confetti(),1800);}
}

// ‚îÄ‚îÄ ROUTER ‚îÄ‚îÄ
function init(){
  const params=new URLSearchParams(window.location.search);
  const bowl=params.get('bowl');
  if(bowl){
    try{
      const data=JSON.parse(decodeURIComponent(escape(atob(bowl))));
      document.getElementById('creator').classList.remove('active');
      document.getElementById('viewer').classList.add('active');
      buildViewerDOM(data,document.getElementById('viewer-content'),false);
      document.title=data.r?`üç≤ A Bowl for ${data.r}`:'üç≤ A Bowl from Lifesoup';
    }catch(e){showToast('That bowl spilled ‚Äî link looks broken üòÖ');}
  }
}

// ‚îÄ‚îÄ CONFETTI ‚îÄ‚îÄ
function confetti(){
  if(!document.getElementById('cf-style')){const s=document.createElement('style');s.id='cf-style';s.textContent=`@keyframes cffall{0%{transform:translateY(-10px) rotate(0);opacity:1;}100%{transform:translateY(100vh) rotate(700deg);opacity:0;}}`;document.head.appendChild(s);}
  const colors=['#d4531a','#f5e0c0','#c07820','#f08050','#fff','#e8c97a','#5a8a3a','#fceef1'];
  const shapes=['50%','2px','4px'];
  for(let i=0;i<80;i++){
    const c=document.createElement('div');const size=5+Math.random()*9;
    c.style.cssText=`position:fixed;width:${size}px;height:${size}px;left:${Math.random()*100}vw;top:0;background:${colors[Math.floor(Math.random()*colors.length)]};border-radius:${shapes[Math.floor(Math.random()*shapes.length)]};pointer-events:none;z-index:9998;animation:cffall ${1.4+Math.random()*2.2}s linear ${Math.random()*.9}s forwards;`;
    document.body.appendChild(c);setTimeout(()=>c.remove(),4500);
  }
}

// ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ
function showToast(msg){const t=document.getElementById('toast');t.textContent=msg;t.classList.add('show');setTimeout(()=>t.classList.remove('show'),2800);}

// ‚îÄ‚îÄ HELPERS ‚îÄ‚îÄ
function esc(s){return String(s).replace(/"/g,'&quot;').replace(/</g,'&lt;');}
function hesc(s){return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');}

init();
</script>
</body>
</html>
